import"./task_log.cd346713.js";import"./args_editor_v2.111646fb.js";function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},a={},o=t.parcelRequiree398;null==o&&((o=function(e){if(e in s)return s[e].exports;if(e in a){var t=a[e];delete a[e];var o={id:e,exports:{}};return s[e]=o,t.call(o.exports,o,o.exports),o.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},t.parcelRequiree398=o);var n=o("jAw9N");var r=o("fcdvt");o("ejx16");n=o("jAw9N");var l=o("ejx16"),i=o("azvlV");let c=null;function u(){return c||"https://global.2cc.net"}async function d(e,t=null,s=null){var a;const o=function(){if(!e.path_args)return e.base_url+e.path_url;const t=e.path_url.split("/").map((t=>t.startsWith("{")&&t.endsWith("}")?e.path_args[t.substring(1,t.length-1)]:t)).join("/");return e.base_url+t}()+(e.query_args?"?"+new URLSearchParams(e.query_args).toString():""),n=e.header||{"Accept-Type":"application/json"},r=e.body?JSON.stringify(e.body):null,l=null===(a=e.security)||void 0===a?void 0:a.bearer;l&&(n.Authorization=`Bearer ${l}`),r&&!n["Content-Type"]&&(n["Content-Type"]="application/json");const i=await fetch(o,{method:e.method,headers:n,body:r});return i.ok?t?await t(i):await i.json():s?await s(i):null}async function _(e){var t;const s=function(){if(!e.path_args)return e.base_url+e.path_url;const t=e.path_url.split("/").map((t=>t.startsWith("{")&&t.endsWith("}")?e.path_args[t.substring(1,t.length-1)]:t)).join("/");return e.base_url+t}()+(e.query_args?"?"+new URLSearchParams(e.query_args).toString():""),a=e.header||{"Accept-Type":"application/json"},o=e.body?JSON.stringify(e.body):null,n=null===(t=e.security)||void 0===t?void 0:t.bearer;n&&(a.Authorization=`Bearer ${n}`),o&&!a["Content-Type"]&&(a["Content-Type"]="application/json");const r=await fetch(s,{method:e.method,headers:a,body:o});if(r.ok)return await r.json();throw r}class h{constructor(){}get auto_task_id(){return globalThis.__g_auto_task_id||""}set auto_task_id(e){globalThis.__g_auto_task_id=e}get job_is_done(){return globalThis._job_is_done||!1}set job_is_done(e){globalThis._job_is_done=e}get automation_name(){return globalThis.automation_name}get jump_host(){return globalThis._g_playbook_jump}set jump_host(e){globalThis._g_playbook_jump=e}get ssh_host(){return globalThis._g_playbook_host}set ssh_host(e){globalThis._g_playbook_host=e}get playbook_args(){return globalThis._g_playbook_args}set playbook_args(e){globalThis._g_playbook_args=e}}var p=o("6A06t");function g(e){const{open:t,color:s,message:a,onClose:o}=e;return n.jsx(i.Snackbar,{open:t,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"},children:n.jsx(i.Alert,{severity:s,onClose:o,children:a})},a)}class y extends l.Component{constructor(e){super(e),this.state={allow_cancel:!1,show_cancel_confirm:!1,force_cancel:!1,cancel_snackbar_props:{open:!1,message:"",color:"info",onClose:async()=>{const e=this.state.cancel_snackbar_props;e.open=!1,this.setState({cancel_snackbar_props:e})}}}}async componentDidMount(){await this.#e();const e=this,t=new h,s=setInterval((()=>{t.job_is_done&&(clearInterval(s),e.setState({allow_cancel:!1}))}),100)}render(){const e=this.state.cancel_snackbar_props;return n.jsxs(n.Fragment,{children:[this.#t(this.state.allow_cancel),this.#s(),n.jsx(g,{open:e.open,color:e.color,message:e.message,onClose:e.onClose})]})}#t=e=>{if(e)return n.jsx(i.Box,{sx:{width:"92vw",margin:"auto",textAlign:"center",padding:"1rem"},children:n.jsxs(i.ButtonGroup,{children:[n.jsx(i.Button,{color:"secondary",variant:"outlined",onClick:()=>{this.setState({show_cancel_confirm:!0,force_cancel:!1})},children:p.pgettext("ui","取消任务")}),n.jsx(i.Button,{color:"secondary",variant:"outlined",onClick:()=>{this.setState({show_cancel_confirm:!0,force_cancel:!0})},children:p.pgettext("ui","强制结束任务")})]})})};#s=()=>{const e=this.state.force_cancel,t=e?p.pgettext("ui","强制结束任务?"):p.pgettext("ui","取消任务?"),s=e?p.pgettext("ui","您确认强制结束正在运行的任务?"):p.pgettext("ui","您确认取消正在运行的任务?");return n.jsxs(i.Dialog,{open:this.state.show_cancel_confirm,onClose:()=>{this.setState({show_cancel_confirm:!1})},children:[n.jsx(i.DialogTitle,{children:t}),n.jsx(i.DialogContent,{children:n.jsx(i.Alert,{severity:"error",children:s})}),n.jsxs(i.DialogActions,{children:[n.jsx(i.Button,{variant:"outlined",onClick:()=>{this.setState({show_cancel_confirm:!1})},children:p.pgettext("ui","放弃")}),n.jsx(i.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.#a()},children:p.pgettext("ui","确认")})]})]})};#a=async()=>{this.setState({show_cancel_confirm:!1});const e=this.state.force_cancel,{task_id:t}=this.props;try{(await class{static async do_delete(e,t=null,s=null){return await d({method:"DELETE",base_url:u(),path_url:"/api/task/cancel/{task_id}",path_args:e.path_args||null,query_args:e.query_args||null,header:e.header||null,body:e.body||null,security:e.security||null},t,s)}static async do_delete_json(e){return await _({method:"DELETE",base_url:u(),path_url:"/api/task/cancel/{task_id}",path_args:e.path_args||null,query_args:e.query_args||null,header:e.header||null,body:e.body||null,security:e.security||null})}}.do_delete_json({path_args:{task_id:t},query_args:{force:e}})).ok?this.#o({color:"success",message:p.pgettext("ui","取消任务成功"),open:!0}):this.#o({color:"error",message:p.pgettext("ui","取消任务失败"),open:!0})}catch(e){this.#o({color:"error",message:p.pgettext("ui","取消任务失败")+`: ${e}`,open:!0})}};#e=async()=>{const e=this.props.task_id;try{const t=await class{static async do_get(e,t=null,s=null){return await d({method:"GET",base_url:u(),path_url:"/api/task/info/{task_id}",path_args:e.path_args||null,query_args:e.query_args||null,header:e.header||null,body:e.body||null,security:e.security||null},t,s)}static async do_get_json(e){return await _({method:"GET",base_url:u(),path_url:"/api/task/info/{task_id}",path_args:e.path_args||null,query_args:e.query_args||null,header:e.header||null,body:e.body||null,security:e.security||null})}}.do_get_json({path_args:{task_id:e}});if(t.is_end){(new h).job_is_done=!0}const s=!t.is_end;this.setState({allow_cancel:s})}catch(t){console.error("fetch task info failed",{e:t,task_id:e})}};#o=e=>{const t=this.state.cancel_snackbar_props;t.color=e.color,t.message=e.message,t.open=e.open,this.setState({cancel_snackbar_props:t})}}n=o("jAw9N"),l=o("ejx16"),i=o("azvlV");var b,k,f=o("jVBUq");p=o("6A06t");function m(e){const{open:t,color:s,message:a,onClose:o}=e;return n.jsx(i.Snackbar,{open:t,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"},children:n.jsx(i.Alert,{severity:s,onClose:o,children:a})},a)}class x extends l.Component{constructor(e){super(e),this.state={allow_delete:!1,show_delete_confirm:!1,delete_snackbar_props:{open:!1,message:"",color:"info",onClose:async()=>{const e=this.state.delete_snackbar_props;e.open=!1,this.setState({delete_snackbar_props:e})}}}}async componentDidMount(){const e=this,t=new h,s=setInterval((()=>{t.job_is_done&&(clearInterval(s),e.setState({allow_delete:!0}))}),100)}render(){const e=this.state.delete_snackbar_props;return n.jsxs(n.Fragment,{children:[this.#n(this.state.allow_delete),this.#r(),n.jsx(m,{open:e.open,color:e.color,message:e.message,onClose:e.onClose})]})}#n=e=>{if(e)return n.jsx(i.Box,{sx:{width:"92vw",margin:"auto",textAlign:"center",padding:"1rem"},children:n.jsx(i.Button,{color:"secondary",variant:"outlined",onClick:()=>{this.setState({show_delete_confirm:!0})},children:p.pgettext("ui","删除任务")})})};#r=()=>n.jsxs(i.Dialog,{open:this.state.show_delete_confirm,onClose:()=>{this.setState({show_delete_confirm:!1})},children:[n.jsx(i.DialogTitle,{children:p.pgettext("ui","您确认删除此任务?")}),n.jsx(i.DialogContent,{children:n.jsx(i.Alert,{severity:"error",children:p.pgettext("ui","任务删除之后将无法恢复，并且您也无法网页查看此任务，确认删除?")})}),n.jsxs(i.DialogActions,{children:[n.jsx(i.Button,{variant:"outlined",onClick:()=>{this.setState({show_delete_confirm:!1})},children:p.pgettext("ui","放弃删除")}),n.jsx(i.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.#l()},children:p.pgettext("ui","确认删除")})]})]});#o=e=>{const t=this.state.delete_snackbar_props;t.color=e.color,t.message=e.message,t.open=e.open,this.setState({delete_snackbar_props:t})};#l=async()=>{this.setState({show_delete_confirm:!1});const{task_id:t}=this.props;try{const s=await class{static async do_delete(e,t=null,s=null){return await d({method:"DELETE",base_url:u(),path_url:"/api/task/delete/{task_id}",path_args:e.path_args||null,query_args:e.query_args||null,header:e.header||null,body:e.body||null,security:e.security||null},t,s)}static async do_delete_json(e){return await _({method:"DELETE",base_url:u(),path_url:"/api/task/delete/{task_id}",path_args:e.path_args||null,query_args:e.query_args||null,header:e.header||null,body:e.body||null,security:e.security||null})}}.do_delete_json({path_args:{task_id:t}});if(s.ok)this.#i(5);else{const t="删除任务失败: {{msg}}";this.#o({color:"error",message:e(f).render(t,{msg:s.msg}),open:!0})}}catch(t){const s="删除任务失败: {{msg}}";this.#o({color:"error",message:e(f).render(s,{msg:t.toString()}),open:!0})}};#i=t=>{setInterval((()=>{const s=p.pgettext("ui","删除任务成功! ({{seconds}}秒后跳转到首页");this.#o({color:"success",message:e(f).render(s,{seconds:t}),open:!0}),(t-=1)<=0&&(location.href="/")}),1e3)}}function j(e){return n.jsxs(n.Fragment,{children:[n.jsx(y,{task_id:e.task_id}),n.jsx(x,{task_id:e.task_id})]})}b="task-operation",k=(t,s)=>{e(r).render(n.jsx(j,{task_id:s}),t)},[...document.querySelectorAll(`[data-type=${b}]`)].forEach((e=>{if(e.removeAttribute("data-type"),e.dataset.value){const t=JSON.parse(e.dataset.value);e.removeAttribute("data-value"),k(e,t)}else k(e,null)}));